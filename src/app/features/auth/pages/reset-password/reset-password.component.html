<div class="reset-password-container">
  <div class="card">
    <div class="card-header">
      <h2>üîê Redefinir Senha</h2>
      <p>Crie uma nova senha para sua conta</p>
    </div>

    <div *ngIf="message" [ngClass]="'alert alert-' + messageType">
      {{ message }}
    </div>

    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" *ngIf="token">
      <div class="form-group">
        <label for="newPassword">Nova Senha</label>
        <div class="password-input-group">
          <input [type]="showPassword ? 'text' : 'password'" class="form-control" id="newPassword"
            formControlName="newPassword" placeholder="M√≠nimo 6 caracteres"
            [class.is-invalid]="submitted && f['newPassword'].errors" />
          <button type="button" class="toggle-password" (click)="togglePassword()"
            aria-label="Alternar visibilidade da senha">
            @if (showPassword) {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
            </svg>
            } @else {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
            }
          </button>
        </div>

        <div class="password-strength" *ngIf="f['newPassword'].value">
          <small>
            <div [class.check]="hasMinLength()">
              <span>‚úì</span> M√≠nimo 6 caracteres
            </div>
            <div [class.check]="hasUpperCase()">
              <span>‚úì</span> Letra mai√∫scula
            </div>
            <div [class.check]="hasLowerCase()">
              <span>‚úì</span> Letra min√∫scula
            </div>
            <div [class.check]="hasNumber()">
              <span>‚úì</span> N√∫mero
            </div>
          </small>
        </div>

        <div *ngIf="submitted && f['newPassword'].errors" class="invalid-feedback">
          <span *ngIf="f['newPassword'].errors['required']">
            Senha √© obrigat√≥ria
          </span>
          <span *ngIf="f['newPassword'].errors['minlength']">
            M√≠nimo 6 caracteres
          </span>
          <span *ngIf="f['newPassword'].errors['passwordStrength']">
            Senha deve conter mai√∫scula, min√∫scula e n√∫mero
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmar Senha</label>
        <div class="password-input-group">
          <input [type]="showConfirmPassword ? 'text' : 'password'" class="form-control" id="confirmPassword"
            formControlName="confirmPassword" placeholder="Confirme sua nova senha" [class.is-invalid]="
              submitted && 
              (f['confirmPassword'].errors || resetPasswordForm.errors?.['passwordMismatch'])
            " />
          <button type="button" class="toggle-password" (click)="toggleConfirmPassword()"
            aria-label="Alternar visibilidade da senha">
            @if (showConfirmPassword) {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
            </svg>
            } @else {
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
            </svg>
            }
          </button>
        </div>

        <div *ngIf="submitted && resetPasswordForm.errors?.['passwordMismatch']" class="invalid-feedback">
          As senhas n√£o conferem
        </div>
        <div *ngIf="submitted && f['confirmPassword'].errors?.['required']" class="invalid-feedback">
          Confirma√ß√£o de senha √© obrigat√≥ria
        </div>
      </div>

      <button type="submit" class="btn btn-primary btn-block" [disabled]="loading || resetPasswordForm.invalid">
        <span *ngIf="!loading">Redefinir Senha</span>
        <span *ngIf="loading">
          <span class="spinner-border spinner-border-sm"></span> Processando...
        </span>
      </button>
    </form>

    <div class="form-footer">
      <button type="button" class="btn btn-link" (click)="goToLogin()">
        ‚Üê Voltar para Login
      </button>
    </div>
  </div>
</div>