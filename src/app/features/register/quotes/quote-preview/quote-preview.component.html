<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-4">
      <button appButton variant="ghost" size="sm" (click)="goBack()">
        <lucide-icon [img]="ArrowLeftIcon" class="h-5 w-5"></lucide-icon>
      </button>
      <div>
        <h1 class="text-3xl font-bold tracking-tight">Visualizar Orçamento</h1>
        <p class="text-muted-foreground">
          Detalhes completos do orçamento
        </p>
      </div>
    </div>

    @if (!isLoading && quote) {
    <div class="flex items-center space-x-2">
      <button appButton variant="outline" (click)="exportToPDF()" [disabled]="isExporting">
        <lucide-icon [img]="FileDownIcon" class="mr-2 h-4 w-4"></lucide-icon>
        {{ isExporting ? 'Exportando...' : 'Exportar PDF' }}
      </button>

      @if (canEdit()) {
      <button appButton variant="outline" (click)="editQuote()">
        Editar
      </button>
      }

      @if (canSend()) {
      <button appButton (click)="sendQuote()" [disabled]="isProcessing">
        <lucide-icon [img]="SendIcon" class="mr-2 h-4 w-4"></lucide-icon>
        Enviar
      </button>
      }

      @if (canAccept()) {
      <button appButton (click)="acceptQuote()" [disabled]="isProcessing" class="bg-green-600 hover:bg-green-700">
        <lucide-icon [img]="CheckCircleIcon" class="mr-2 h-4 w-4"></lucide-icon>
        Aceitar
      </button>
      }

      @if (canReject()) {
      <button appButton variant="outline" (click)="rejectQuote()" [disabled]="isProcessing"
        class="text-red-600 border-red-600 hover:bg-red-50">
        <lucide-icon [img]="XCircleIcon" class="mr-2 h-4 w-4"></lucide-icon>
        Rejeitar
      </button>
      }

      @if (canConvertToContract()) {
      <button appButton (click)="convertToContract()" class="bg-emerald-600 hover:bg-emerald-700">
        <lucide-icon [img]="FileTextIcon" class="mr-2 h-4 w-4"></lucide-icon>
        Converter em evento
      </button>
      }
    </div>
    }
  </div>

  <!-- Success Message -->
  @if (successMessage) {
  <div class="w-full p-3 text-sm text-green-600 bg-green-50 border border-green-200 rounded-md">
    {{ successMessage }}
  </div>
  }

  <!-- Error Message -->
  @if (errorMessage) {
  <div class="w-full p-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded-md">
    {{ errorMessage }}
  </div>
  }

  <!-- Loading State -->
  @if (isLoading) {
  <div class="text-center py-12">
    <p class="text-muted-foreground">Carregando orçamento...</p>
  </div>
  }

  <!-- Quote Preview -->
  @if (!isLoading && quote) {
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
      <!-- Quote Header Card -->
      <div class="bg-white rounded-lg border p-6">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h2 class="text-2xl font-bold text-gray-900">
              Orçamento #{{ quote.id.slice(0, 8).toUpperCase() }}
            </h2>
            <p class="text-sm text-gray-500 mt-1">
              Criado em {{ formatDate(quote.createdAt) }}
            </p>
          </div>
          <span class="inline-flex items-center rounded-full px-3 py-1 text-sm font-medium"
            [ngClass]="getStatusColor(quote.status)">
            {{ quote.status }}
          </span>
        </div>

        <!-- Client Info -->
        <div class="border-t pt-6">
          <h3 class="text-lg font-semibold mb-4">Informações do Cliente</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-500">Nome</p>
              <p class="font-medium">{{ quote.client?.name || '-' }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Email</p>
              <p class="font-medium">{{ quote.client?.email || '-' }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Telefone</p>
              <p class="font-medium">{{ quote.client?.phone || '-' }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">CPF</p>
              <p class="font-medium">{{ quote.client?.cpf || '-' }}</p>
            </div>
          </div>
        </div>

        <!-- Event Info (if exists) -->
        @if (quote.event) {
        <div class="border-t pt-6 mt-6">
          <h3 class="text-lg font-semibold mb-4">Informações do Evento</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-500">Nome do Evento</p>
              <p class="font-medium">{{ quote.event.name }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Data do Evento</p>
              <p class="font-medium">{{ formatDate(quote.event.eventDate) }}</p>
            </div>
            @if (quote.event.eventTime) {
            <div>
              <p class="text-sm text-gray-500">Horário</p>
              <p class="font-medium">{{ formatTime(quote.event.eventTime) }}</p>
            </div>
            }
            @if (quote.event.unit?.name) {
            <div>
              <p class="text-sm text-gray-500">Local</p>
              <p class="font-medium">{{ quote.event.unit?.name }}</p>
            </div>
            }
          </div>
        </div>
        }

        <!-- Package Info -->
        <div class="border-t pt-6 mt-6">
          <h3 class="text-lg font-semibold mb-4">Pacote Base</h3>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-500">Nome do Pacote</p>
              <p class="font-medium">{{ quote.package?.name || '-' }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-500">Tipo</p>
              <p class="font-medium">{{ quote.package?.type || '-' }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Items Card -->
      <div class="bg-white rounded-lg border p-6">
        <h3 class="text-lg font-semibold mb-4">Itens do Orçamento</h3>
        <div class="space-y-3">
          @for (item of quote.items; track item.id) {
          <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div class="flex-1">
              <p class="font-medium text-gray-900">{{ item.description }}</p>
              <p class="text-sm text-gray-500">
                Quantidade: {{ item.quantity }} × {{ formatCurrency(item.unitPrice) }}
              </p>
            </div>
            <div class="text-right">
              <p class="text-lg font-bold text-gray-900">
                {{ formatCurrency(item.totalPrice) }}
              </p>
            </div>
          </div>
          }
        </div>

        <!-- Total -->
        <div class="border-t mt-6 pt-6">
          <div class="flex items-center justify-between">
            <p class="text-xl font-semibold text-gray-900">Total</p>
            <p class="text-3xl font-bold text-emerald-600">
              {{ formatCurrency(quote.totalAmount) }}
            </p>
          </div>
        </div>
      </div>

      <!-- Notes (if exists) -->
      @if (quote.notes) {
      <div class="bg-white rounded-lg border p-6">
        <h3 class="text-lg font-semibold mb-3">Observações</h3>
        <p class="text-gray-700 whitespace-pre-wrap">{{ quote.notes }}</p>
      </div>
      }
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Status Card -->
      <div class="bg-white rounded-lg border p-6">
        <h3 class="text-lg font-semibold mb-4">Status</h3>
        <div class="space-y-3">
          <div>
            <p class="text-sm text-gray-500">Status Atual</p>
            <span class="inline-flex items-center rounded-full px-3 py-1 text-sm font-medium mt-1"
              [ngClass]="getStatusColor(quote.status)">
              {{ quote.status }}
            </span>
          </div>
          <div>
            <p class="text-sm text-gray-500">Válido até</p>
            <p class="font-medium mt-1">{{ formatDate(quote.validUntilDate) }}</p>
          </div>
          @if (quote.sentAt) {
          <div>
            <p class="text-sm text-gray-500">Enviado em</p>
            <p class="font-medium mt-1">{{ formatDate(quote.sentAt) }}</p>
          </div>
          }
        </div>
      </div>

      <!-- Actions Card -->
      <div class="bg-emerald-50 rounded-lg border border-emerald-200 p-6">
        <h3 class="text-lg font-semibold mb-3 text-emerald-900">Ações Rápidas</h3>
        <div class="space-y-2">
          <button appButton variant="outline" class="w-full justify-start" (click)="exportToPDF()"
            [disabled]="isExporting">
            <lucide-icon [img]="FileDownIcon" class="mr-2 h-4 w-4"></lucide-icon>
            Baixar PDF
          </button>

          @if (canEdit()) {
          <button appButton variant="outline" class="w-full justify-start" (click)="editQuote()">
            Editar Orçamento
          </button>
          }

          @if (canSend()) {
          <button appButton class="w-full justify-start" (click)="sendQuote()" [disabled]="isProcessing">
            <lucide-icon [img]="SendIcon" class="mr-2 h-4 w-4"></lucide-icon>
            Enviar ao Cliente
          </button>
          }

          @if (canConvertToContract()) {
          <button appButton class="w-full justify-start bg-emerald-600 hover:bg-emerald-700" (click)="convertToContract()">
            <lucide-icon [img]="FileTextIcon" class="mr-2 h-4 w-4"></lucide-icon>
            Converter em evento
          </button>
          }
        </div>
      </div>

      <!-- Timeline/History -->
      <div class="bg-white rounded-lg border p-6">
        <h3 class="text-lg font-semibold mb-4">Histórico</h3>
        <div class="space-y-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <div class="w-2 h-2 rounded-full bg-emerald-500 mt-2"></div>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium">Orçamento criado</p>
              <p class="text-xs text-gray-500">{{ formatDate(quote.createdAt) }}</p>
            </div>
          </div>

          @if (quote.sentAt) {
          <div class="flex">
            <div class="flex-shrink-0">
              <div class="w-2 h-2 rounded-full bg-blue-500 mt-2"></div>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium">Enviado ao cliente</p>
              <p class="text-xs text-gray-500">{{ formatDate(quote.sentAt) }}</p>
            </div>
          </div>
          }

          @if (quote.status === 'Aceito' || quote.status === 'Rejeitado') {
          <div class="flex">
            <div class="flex-shrink-0">
              <div class="w-2 h-2 rounded-full mt-2"
                [ngClass]="quote.status === 'Aceito' ? 'bg-green-500' : 'bg-red-500'"></div>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium">
                {{ quote.status === 'Aceito' ? 'Aceito pelo cliente' : 'Rejeitado pelo cliente' }}
              </p>
              <p class="text-xs text-gray-500">{{ formatDate(quote.updatedAt || quote.createdAt) }}</p>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
  }
</div>