<div>
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Templates de Checklist</h1>
      <p class="text-gray-600 mt-1">Gerencie templates reutilizáveis para seus eventos</p>
    </div>
    <a routerLink="/cadastros/checklists/templates/novo">
      <app-button variant="default">
        <lucide-icon [img]="PlusIcon" class="w-4 h-4 mr-2"></lucide-icon>
        Novo Template
      </app-button>
    </a>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6">
    <div class="flex flex-col sm:flex-row gap-4">
      <!-- Search -->
      <div class="flex-1 relative">
        <lucide-icon [img]="SearchIcon" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></lucide-icon>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          placeholder="Buscar templates..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
        />
      </div>
      
      <!-- Event Type Filter -->
      <select
        [(ngModel)]="selectedEventType"
        (ngModelChange)="onEventTypeChange()"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
      >
        <option value="">Todos os tipos</option>
        <option *ngFor="let type of eventTypes" [value]="type">{{ type }}</option>
      </select>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="flex justify-center py-12">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
    {{ error }}
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredTemplates.length === 0" class="text-center py-12 bg-white rounded-lg shadow-sm border border-gray-200">
    <lucide-icon [img]="ClipboardListIcon" class="w-12 h-12 text-gray-400 mx-auto mb-4"></lucide-icon>
    <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhum template encontrado</h3>
    <p class="text-gray-500 mb-4">Crie seu primeiro template de checklist para começar</p>
    <a routerLink="/cadastros/checklists/templates/novo">
      <app-button variant="default">
        <lucide-icon [img]="PlusIcon" class="w-4 h-4 mr-2"></lucide-icon>
        Criar Template
      </app-button>
    </a>
  </div>

  <!-- Templates Grid -->
  <div *ngIf="!isLoading && filteredTemplates.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <div 
      *ngFor="let template of filteredTemplates" 
      class="bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow"
    >
      <div class="p-5">
        <!-- Header -->
        <div class="flex items-start justify-between mb-3">
          <div class="flex-1">
            <h3 class="font-semibold text-gray-900 text-lg">{{ template.name }}</h3>
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 mt-1">
              {{ template.eventType }}
            </span>
          </div>
          <span 
            class="px-2 py-1 text-xs rounded-full"
            [ngClass]="template.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'"
          >
            {{ template.isActive ? 'Ativo' : 'Inativo' }}
          </span>
        </div>

        <!-- Description -->
        <p *ngIf="template.description" class="text-sm text-gray-600 mb-4 line-clamp-2">
          {{ template.description }}
        </p>

        <!-- Stats -->
        <div class="flex items-center gap-4 text-sm text-gray-500 mb-4">
          <div class="flex items-center gap-1">
            <lucide-icon [img]="ClipboardListIcon" class="w-4 h-4"></lucide-icon>
            <span>{{ getItemCount(template) }} itens</span>
          </div>
          <div *ngIf="template._count?.events">
            <span>{{ template._count?.events }} eventos</span>
          </div>
        </div>

        <!-- Phase breakdown -->
        <div class="flex flex-wrap gap-2 mb-4" *ngIf="template.items?.length">
          <span class="text-xs px-2 py-1 rounded bg-blue-50 text-blue-700">
            Pré: {{ getItemsByPhase(template, 'pre-event') }}
          </span>
          <span class="text-xs px-2 py-1 rounded bg-amber-50 text-amber-700">
            Dia: {{ getItemsByPhase(template, 'event-day') }}
          </span>
          <span class="text-xs px-2 py-1 rounded bg-green-50 text-green-700">
            Pós: {{ getItemsByPhase(template, 'post-event') }}
          </span>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-2 pt-3 border-t border-gray-100">
          <a 
            [routerLink]="['/cadastros/checklists/templates/editar', template.id]"
            class="flex-1 flex items-center justify-center gap-1 px-3 py-2 text-sm text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors"
          >
            <lucide-icon [img]="PencilIcon" class="w-4 h-4"></lucide-icon>
            Editar
          </a>
          <button 
            (click)="duplicateTemplate(template)"
            class="flex items-center justify-center gap-1 px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
            title="Duplicar template"
          >
            <lucide-icon [img]="CopyIcon" class="w-4 h-4"></lucide-icon>
          </button>
          <button 
            (click)="handleDeleteClick(template)"
            class="flex items-center justify-center gap-1 px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors"
            title="Excluir template"
          >
            <lucide-icon [img]="Trash2Icon" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<app-confirmation-modal
  [isOpen]="showDeleteModal"
  (onClose)="handleCancelDelete()"
  (onConfirm)="handleConfirmDelete()"
  title="Excluir Template"
  [message]="'Tem certeza que deseja excluir o template &quot;' + (templateToDelete?.name || '') + '&quot;? Esta ação não pode ser desfeita.'"
  confirmText="Excluir"
  cancelText="Cancelar"
  variant="danger"
  [loading]="isDeleting"
></app-confirmation-modal>

